<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JSON比对工具</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <header>
      <h1>JSON比对工具</h1>
      <p>支持过滤字段、重要字段、业务模型分区展示，并保存到浏览器本地</p>
    </header>

    <div class="controls">
      <div class="control-group">
        <label for="filterFields">过滤字段（逗号分隔）</label>
        <input id="filterFields" type="text" placeholder="例如：id, timestamp, metadata" />
      </div>
      <div class="control-group">
        <label for="importantFields">重要字段（逗号分隔）</label>
        <input id="importantFields" type="text" placeholder="例如：name, email, status" />
      </div>
      <div class="control-group row">
        <label class="checkbox"><input id="ignoreCase" type="checkbox" /> 忽略大小写（仅用于比较）</label>
        <label class="checkbox"><input id="ignoreWhitespace" type="checkbox" /> 忽略空白（仅用于比较）</label>
      </div>
      <button id="compareBtn" class="btn-primary"><i class="fas fa-magnifying-glass"></i> 开始比对</button>
    </div>

    <details class="models" open>
      <summary>业务模型设置（保存到浏览器）</summary>
      <div class="models-body">
        <div class="models-left">
          <div class="models-toolbar">
            <button id="addModelBtn" class="btn-secondary"><i class="fas fa-plus"></i> 新增模型</button>
            <button id="resetModels" class="btn-secondary"><i class="fas fa-rotate-left"></i> 重置</button>
          </div>
          <div id="modelsList" class="models-list" aria-live="polite"></div>
        </div>
        <div class="models-right">
          <p class="hint">匹配规则：</p>
          <ul>
            <li>字段完全匹配或以“字段.”为前缀均视为命中该模型</li>
            <li>大小写敏感，仅用于匹配路径；不影响显示</li>
            <li>未命中的字段归入“其余字段”，并保持原有顺序</li>
          </ul>
        </div>
      </div>
    </details>

    <div class="json-inputs" id="jsonInputs">
      <div class="panel-header">
        <h2>源数据 <button id="toggleJsonInputs" class="toggle-button" title="折叠/展开"><i class="fas fa-chevron-up"></i></button></h2>
      </div>
      <div class="json-panels">
        <div class="json-panel">
          <h3>JSON A</h3>
          <textarea id="jsonA" placeholder="请输入第一个JSON对象..."></textarea>
          <div class="panel-actions">
            <button class="btn-secondary" onclick="formatJSON('jsonA')"><i class="fas fa-indent"></i> 格式化</button>
            <button class="btn-secondary" onclick="clearJSON('jsonA')"><i class="fas fa-trash"></i> 清空</button>
          </div>
        </div>
        <div class="json-panel">
          <h3>JSON B</h3>
          <textarea id="jsonB" placeholder="请输入第二个JSON对象..."></textarea>
          <div class="panel-actions">
            <button class="btn-secondary" onclick="formatJSON('jsonB')"><i class="fas fa-indent"></i> 格式化</button>
            <button class="btn-secondary" onclick="clearJSON('jsonB')"><i class="fas fa-trash"></i> 清空</button>
          </div>
        </div>
      </div>
    </div>

    <div class="results" id="results" style="display:none;">
      <h3>比对结果</h3>
      <div class="result-stats">
        <div class="stat"><span class="stat-label">总字段数</span><span id="totalFields" class="stat-value">0</span></div>
        <div class="stat"><span class="stat-label">相同字段</span><span id="sameFields" class="stat-value same">0</span></div>
        <div class="stat"><span class="stat-label">不同字段</span><span id="diffFields" class="stat-value diff">0</span></div>
        <div class="stat"><span class="stat-label">缺失字段</span><span id="missingFields" class="stat-value missing">0</span></div>
      </div>

      <div class="result-tabs">
        <button class="tab-btn active" data-tab="all">所有字段</button>
        <button class="tab-btn" data-tab="diff">仅差异</button>
        <button class="tab-btn" data-tab="same">仅相同</button>
        <button class="tab-btn" data-tab="missing">仅缺失</button>
        <button class="tab-fullscreen-btn" id="tabFullscreenToggle" title="全屏"><i class="fas fa-expand"></i></button>
        <button class="tab-fullscreen-return" id="tabFullscreenReturn" title="返回" style="display:none;"><i class="fas fa-arrow-left"></i> 返回</button>
      </div>

      <div class="layout-controls">
        <span style="font-size:12px;color:#666;">布局:</span>
        <div class="layout-preset">
          <button class="preset-btn" onclick="setGridLayout('auto')" title="自动"><i class="fas fa-th"></i> 自动</button>
          <button class="preset-btn" onclick="setGridLayout('1-col')" title="单列"><i class="fas fa-bars"></i> 1列</button>
          <button class="preset-btn" onclick="setGridLayout('2-col')" title="双列"><i class="fas fa-columns"></i> 2列</button>
          <button class="preset-btn" onclick="setGridLayout('3-col')" title="三列"><i class="fas fa-th-large"></i> 3列</button>
        </div>
        <button onclick="resetLayout()" title="重置布局"><i class="fas fa-undo"></i> 重置</button>
        <button onclick="saveLayout()" title="保存当前布局"><i class="fas fa-save"></i> 保存布局</button>
        
        <span style="font-size:12px;color:#666;margin-left:12px;">字体:</span>
        <div class="font-controls">
          <button class="preset-btn" onclick="adjustFontSize(-1)" title="字体缩小"><i class="fas fa-minus"></i></button>
          <span class="font-size-display" id="fontSizeDisplay">12</span>
          <button class="preset-btn" onclick="adjustFontSize(1)" title="字体放大"><i class="fas fa-plus"></i></button>
          <button class="preset-btn" onclick="resetFontSize()" title="重置字体"><i class="fas fa-undo"></i></button>
        </div>
      </div>

      <div class="result-content">
        <div id="diffResult" class="diff-result"></div>
      </div>

      <div class="export-actions">
        <button class="btn-secondary" onclick="exportResults()"><i class="fas fa-download"></i> 导出</button>
        <button class="btn-secondary" onclick="copyResults()"><i class="fas fa-copy"></i> 复制</button>
      </div>
    </div>
  </div>

  <script src="script.js?v=3.4"></script>
  
  <!-- 模型编辑模态框 -->
  <div id="modelModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="modalTitle">新增模型</h4>
        <button id="modalClose" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div>
          <label for="modalModelName">模型名称</label>
          <input type="text" id="modalModelName" class="control-input" placeholder="例如：用户信息">
        </div>
        <div>
          <label for="modalModelPaths">匹配路径（每行一个）</label>
          <textarea id="modalModelPaths" class="control-textarea" placeholder="例如：
user
user.name
user.email"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button id="modalCancel" class="btn-secondary">取消</button>
        <button id="modalSave" class="btn-primary">保存</button>
      </div>
    </div>
  </div>
</body>
</html>


